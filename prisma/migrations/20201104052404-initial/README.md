# Migration `20201104052404-initial`

This migration has been generated by Ali Zahid at 11/4/2020, 10:24:04 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Account" (
"id" SERIAL,
"compoundId" text   NOT NULL ,
"userId" integer   NOT NULL ,
"providerType" text   NOT NULL ,
"providerId" text   NOT NULL ,
"providerAccountId" text   NOT NULL ,
"refreshToken" text   ,
"accessToken" text   ,
"accessTokenExpires" timestamp(3)   ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Session" (
"id" SERIAL,
"userId" integer   NOT NULL ,
"expires" timestamp(3)   NOT NULL ,
"sessionToken" text   NOT NULL ,
"accessToken" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Plan" (
"id" text   NOT NULL ,
"visible" boolean   NOT NULL ,
"name" text   NOT NULL ,
"price" integer   NOT NULL ,
"submissions" integer   NOT NULL ,
"forms" integer   NOT NULL ,
"archive" integer   NOT NULL
)

CREATE TABLE "public"."User" (
"id" SERIAL,
"name" text   ,
"email" text   ,
"emailVerified" timestamp(3)   ,
"image" text   ,
"planId" text   NOT NULL DEFAULT E'free',
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Project" (
"id" SERIAL,
"userId" integer   NOT NULL ,
"slug" text   NOT NULL ,
"name" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Form" (
"id" SERIAL,
"projectId" integer   NOT NULL ,
"slug" text   NOT NULL ,
"name" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Response" (
"id" SERIAL,
"formId" integer   NOT NULL ,
"data" jsonb   NOT NULL ,
"meta" jsonb   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "Account.compoundId_unique" ON "public"."Account"("compoundId")

CREATE INDEX "providerAccountId" ON "public"."Account"("providerAccountId")

CREATE INDEX "providerId" ON "public"."Account"("providerId")

CREATE INDEX "userId" ON "public"."Account"("userId")

CREATE UNIQUE INDEX "Session.sessionToken_unique" ON "public"."Session"("sessionToken")

CREATE UNIQUE INDEX "Session.accessToken_unique" ON "public"."Session"("accessToken")

CREATE UNIQUE INDEX "Plan.id_unique" ON "public"."Plan"("id")

CREATE UNIQUE INDEX "User.email_unique" ON "public"."User"("email")

CREATE UNIQUE INDEX "Project.slug_unique" ON "public"."Project"("slug")

CREATE UNIQUE INDEX "Form.slug_unique" ON "public"."Form"("slug")

ALTER TABLE "public"."User" ADD FOREIGN KEY("planId")REFERENCES "public"."Plan"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Project" ADD FOREIGN KEY("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Form" ADD FOREIGN KEY("projectId")REFERENCES "public"."Project"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Response" ADD FOREIGN KEY("formId")REFERENCES "public"."Form"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201104052404-initial
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,114 @@
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model Account {
+  id Int @id @default(autoincrement())
+
+  compoundId         String    @unique
+  userId             Int
+  providerType       String
+  providerId         String
+  providerAccountId  String
+  refreshToken       String?
+  accessToken        String?
+  accessTokenExpires DateTime?
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  @@index([providerAccountId], name: "providerAccountId")
+  @@index([providerId], name: "providerId")
+  @@index([userId], name: "userId")
+}
+
+model Session {
+  id Int @id @default(autoincrement())
+
+  userId       Int
+  expires      DateTime
+  sessionToken String   @unique
+  accessToken  String   @unique
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model Plan {
+  id String @unique
+
+  visible Boolean
+
+  name        String
+  price       Int
+  submissions Int
+  forms       Int
+  archive     Int
+
+  users User[]
+}
+
+model User {
+  id Int @id @default(autoincrement())
+
+  name          String?
+  email         String?   @unique
+  emailVerified DateTime?
+  image         String?
+
+  plan   Plan   @relation(fields: [planId], references: [id])
+  planId String @default("free")
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  projects Project[]
+}
+
+model Project {
+  id Int @id @default(autoincrement())
+
+  user   User @relation(fields: [userId], references: [id])
+  userId Int
+
+  slug String @unique
+  name String
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  forms Form[]
+}
+
+model Form {
+  id Int @id @default(autoincrement())
+
+  project   Project @relation(fields: [projectId], references: [id])
+  projectId Int
+
+  slug String @unique
+  name String
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  responses Response[]
+}
+
+model Response {
+  id Int @id @default(autoincrement())
+
+  form   Form @relation(fields: [formId], references: [id])
+  formId Int
+
+  data Json
+  meta Json
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
```
